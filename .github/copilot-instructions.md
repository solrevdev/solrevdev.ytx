````markdown
# Guidance for AI coding agents working on solrevdev.ytx

This repo is a small .NET global tool (PackageId: `solrevdev.ytx`) that extracts YouTube metadata and captions as JSON. Keep instructions focused, actionable, and tied to concrete files and commands used by humans and CI.

- Entry points:
  - `src/Ytx/Program.cs` — single-file console app; contains the main flow: input parsing (args or JSON stdin), YoutubeExplode calls, caption selection, transcript normalization, and JSON output.
  - `src/Ytx/Ytx.csproj` — packaging details (PackAsTool, ToolCommandName=`ytx`), TargetFrameworks (`net8.0;net9.0`), and Version (auto-bumped by CI).

- What to change and where:
  - Feature or bugfix touching runtime behavior: edit `Program.cs` and add small, well-scoped tests under `tests/` when applicable.
  - Packaging/version bumps: update `<Version>` in `src/Ytx/Ytx.csproj` if needed locally — CI auto-increments on `master` pushes.

- Build / run / package (explicit commands example):
  - Restore: `dotnet restore src/Ytx`
  - Build: `dotnet build src/Ytx -c Release`
  - Run (manual test): `dotnet run --project src/Ytx --framework net8.0 "<YOUTUBE_URL>"`
  - Pack: `dotnet pack src/Ytx -c Release` (packages to `./nupkg` per csproj)
  - Local tool install for verification: `dotnet tool install -g solrevdev.ytx --add-source ./nupkg`

- Key implementation patterns to follow (use exact examples):
  - Input handling: support both CLI arg and JSON via stdin (see `Input` record + Main arg handling in `Program.cs`). Preserve the current usage error behavior (exit code 2 and usage message).
  - Caption selection: prefer English tracks and then auto-generated tracks. See ordering expression in `Program.cs`:
    `manifest.Tracks.OrderByDescending(t => t.Language.Name.Contains("English", ...)).ThenByDescending(t => t.IsAutoGenerated).FirstOrDefault()`
  - Transcript normalization: use `NormalizeCaption` (Regex to collapse whitespace, replace `&nbsp;`) and `ToHhMmSs` for timestamps.
  - JSON output: use System.Text.Json with `UnsafeRelaxedJsonEscaping` and `WriteIndented = true`.

- Tests and quality gates:
  - There are no heavy unit tests in the repo by default; add minimal tests that exercise parsing and formatting logic (e.g., NormalizeCaption, ToHhMmSs) under `tests/`.
  - When editing runtime logic, run the manual `dotnet run` example with a known video URL to validate end-to-end output.

- CI/Release notes for agents:
  - GitHub Actions publish workflow triggers on pushes to `master` or manual dispatch. It expects `NUGET_API_KEY` secret for publishing.
  - CI auto-bumps `<Version>` in `src/Ytx/Ytx.csproj`; prefer not to manually edit unless doing a local test/release.

- External dependencies & compatibility:
  - Uses `YoutubeExplode` (pinned to 6.5.4). Avoid upgrading without testing caption extraction end-to-end.
  - Targets .NET 8 and 9; keep `Nullable` and `ImplicitUsings` enabled to match project style.

- Small fixes that are preferred:
  - Add unit tests for any non-trivial parsing/formatting changes.
  - Keep output JSON shape stable (fields: `url`, `title`, `description`, `transcriptRaw`, `transcript`). Consumers rely on these keys.

- Files worth reading before making changes:
  - `src/Ytx/Program.cs` — main logic
  - `src/Ytx/Ytx.csproj` — packaging/versioning
  - `README.md` — usage, build, and release steps
  - `CLAUDE.md` — additional guidance and implementation notes

If any instruction here is unclear or you'd like more examples (tests, CI snippets, or typical PR diffs), ask and I'll expand this file with concrete snippets.
````